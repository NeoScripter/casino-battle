var B=Object.defineProperty;var R=(d,e,t)=>e in d?B(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var o=(d,e,t)=>R(d,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();const u={TEAM:"team",PARTICIPANT:"participant",REF:"ref",SCORE:"score",PERCENT:"percent",DEPOSIT:"deposit",TABLE:"table-parent-team",CAROUSEL:"carousel-team",TOTAL_SCORE:"total-score-team",WINNER:"carousel-winner-team"};class w{getWinnerImgContainer(e){return l(u.WINNER,"-",e.toString())}getTotalScore(e){return l(u.TOTAL_SCORE,"-",e.toString())}getParticipant(e,t){return l(u.TEAM,"-",e.toString(),"-",u.PARTICIPANT,"-",t.toString())}getRef(e,t){return l(u.TEAM,"-",e.toString(),"-",u.REF,"-",t.toString())}getScore(e,t){return l(u.TEAM,"-",e.toString(),"-",u.SCORE,"-",t.toString())}getPercent(e,t){return l(u.TEAM,"-",e.toString(),"-",u.PERCENT,"-",t.toString())}getDeposit(e,t){return l(u.TEAM,"-",e.toString(),"-",u.DEPOSIT,"-",t.toString())}}const T={REGULAR_CELL:"regular-cell",HEAD_CELL:"head-cell",TEXT_INPUT:"text-input-field",CHECKBOX_INPUT:"checkbox-input-field"};function l(...d){return d.filter(e=>typeof e=="string").join("")}const I=new w;class P{populateTable(e){const t=document.getElementById(u.TABLE+"-"+e.toString());if(t==null)throw new Error("The table is not found");t.innerHTML="",t.appendChild(this.createFirstColumn(e)),t.appendChild(this.createSecondColumn(e)),t.appendChild(this.createThirdColumn(e)),t.appendChild(this.createFourthColumn(e)),t.appendChild(this.createFifthColumn(e))}createFifthColumn(e){const t=document.createElement("div");t.appendChild(this.getTableHead("ДЕПОЗИТ"));for(let n=1;n<4;n++)t.appendChild(this.getDeposit(n,e));return t}createFourthColumn(e){const t=document.createElement("div");t.appendChild(this.getTableHead("ПРОЦЕНТ"));for(let n=1;n<4;n++)t.appendChild(this.getPercentCell(n,e));return t}createThirdColumn(e){const t=document.createElement("div");t.appendChild(this.getTableHead("БАЛЛ"));for(let n=1;n<4;n++)t.appendChild(this.getScoreCell(n,e));return t}createSecondColumn(e){const t=document.createElement("div");t.appendChild(this.getTableHead("РЕФ"));for(let n=1;n<4;n++)t.appendChild(this.getRef(n,e));return t}createFirstColumn(e){const t=document.createElement("div");t.appendChild(this.getTableHead("Участник"));for(let n=1;n<4;n++)t.appendChild(this.getTextInput("Участник "+n.toString(),n,e));return t}getTableHead(e){const t=this.extractTemplateContent(T.HEAD_CELL),n=t.querySelector("div");if(n==null)throw new Error("The template does not contain div element");return n.textContent=e,t}getPercentCell(e,t){const n=this.extractTemplateContent(T.REGULAR_CELL),s=n.querySelector("div");if(s==null)throw new Error("The template does not contain div element");return s.textContent="33.33%",s.id=I.getPercent(t,e),n}getScoreCell(e,t){const n=this.extractTemplateContent(T.REGULAR_CELL),s=n.querySelector("div");if(s==null)throw new Error("The template does not contain div element");return s.textContent="Балл: 1",s.id=I.getScore(t,e),n}getDeposit(e,t){const n=this.extractTemplateContent(T.CHECKBOX_INPUT),s=n.querySelector("input");if(s==null)throw new Error("The template does not contain input element");return s.id=I.getDeposit(t,e),n}getRef(e,t){const n=this.extractTemplateContent(T.CHECKBOX_INPUT),s=n.querySelector("input");if(s==null)throw new Error("The template does not contain input element");return s.id=I.getRef(t,e),n}getTextInput(e="Участник",t,n){const s=this.extractTemplateContent(T.TEXT_INPUT),r=s.querySelector("input");if(r==null)throw new Error("The template does not contain input element");return r.placeholder=e,r.id=I.getParticipant(n,t),s}extractTemplateContent(e){const t=document.getElementById(e);if(t==null||t.content==null)throw new Error("The template is empty or non existent");return t.content.cloneNode(!0)}}const _="images/carousel/",U=["bandit","bigbass","bonanza","dog","dogmulti","giza","mental","mummy","olympus","sugar"],y=new w;class b{constructor(e){o(this,"teamNumber");o(this,"parent");o(this,"figure");o(this,"images");o(this,"imageLength");o(this,"gap");o(this,"theta");o(this,"currImage");o(this,"bfc");o(this,"rotationInterval",null);o(this,"isRotating",!1);if(this.teamNumber=e,this.parent=document.getElementById(u.CAROUSEL+"-"+this.teamNumber.toString()),!this.parent)throw new Error("Carousel container not found!");if(this.figure=this.parent.querySelector("figure"),!this.figure)throw new Error("Carousel structure is missing `figure`!");this.images=this.figure.children,this.imageLength=this.images.length,this.gap=parseFloat(this.parent.dataset.gap||"10"),this.bfc="bfc"in this.parent.dataset,this.theta=this.imageLength>0?2*Math.PI/this.imageLength:0,this.currImage=0}init(){this.createCarousel(),this.setupCarousel(),this.initResize()}getCurrentImagePath(){if(!this.images||this.imageLength===0)return;const e=this.images[this.currImage%this.imageLength];if(!e)return;const t=e.querySelector("img");if(t)return t.src}createCarousel(){if(!this.parent||!this.figure)throw new Error("The figure element is missing!");this.figure.innerHTML="";for(const e of U){const t=document.createElement("div"),n=document.createElement("img");n.src=l(_,e,".png"),n.classList.add("border-3","border-white"),t.appendChild(n),this.figure.appendChild(t)}this.images=this.figure.children,this.imageLength=this.images.length,this.theta=this.imageLength>0?2*Math.PI/this.imageLength:0}setupCarousel(){if(!this.images||this.imageLength===0||!this.figure){console.error("No valid images found for the carousel!");return}const e=this.images[0];if(!e){console.error("First image not found!");return}const t=parseFloat(getComputedStyle(e).width);if(isNaN(t)||t<=0){console.error(" Invalid image width detected:",t);return}const n=t/(2*Math.tan(Math.PI/this.imageLength));this.figure.style.transformOrigin=`50% 50% ${-n}px`;for(let s=0;s<this.imageLength;s++){const r=this.images[s];r.style.padding=`0 ${this.gap}px`,r.style.transformOrigin=`50% 50% ${-n}px`,r.style.transform=`rotateY(${s*this.theta}rad)`,this.bfc&&(r.style.backfaceVisibility="hidden")}this.rotateCarousel(this.currImage)}rotateCarousel(e){if(!this.figure){console.error("Error: Figure element is missing!");return}if(isNaN(e)||isNaN(this.theta)||!isFinite(this.theta)){console.error("Invalid rotation value:",{imageIndex:e,theta:this.theta});return}this.figure.style.transform=`rotateY(${e*-this.theta}rad)`}startInfiniteRotation(){if(this.isRotating)return;this.isRotating=!0;let e=50;const t=Math.random()*5e3+4e3,n=Date.now(),s=()=>{this.currImage++,this.rotateCarousel(this.currImage);const r=Date.now()-n;e=50+r/t*950,r>=t?(clearInterval(this.rotationInterval),this.isRotating=!1,this.showWinner()):(clearInterval(this.rotationInterval),this.rotationInterval=window.setInterval(s,e))};this.rotationInterval=window.setInterval(s,e)}showWinner(){const e=y.getWinnerImgContainer(this.teamNumber),t=document.getElementById(e);if(t==null)return;const n=t.querySelector("img");if(n==null)return;const s=this.getCurrentImagePath();s==null||this.parent==null||(n.src=s,t.classList.remove("!hidden"),this.parent.classList.add("absolute"),this.parent.style.opacity="0%",setTimeout(()=>{this.parent!=null&&(this.parent.classList.add("!hidden"),this.parent.style.opacity="100%",this.parent.classList.remove("absolute"))},500))}resetDisplay(){var n;const e=y.getWinnerImgContainer(this.teamNumber),t=document.getElementById(e);t!=null&&(t.classList.add("!hidden"),(n=this.parent)==null||n.classList.remove("!hidden"))}initResize(){window.addEventListener("resize",()=>{this.setupCarousel()})}}const p=new w,h={CALCULATE_BTN:"calculate-team",BONUS_INPUT:"bonus-team",PERCENT_INPUT:"percent-team",BET_INPUT:"bet-team",RESULT_TABLE:"table-results-team",PARENT_TABLE:"table-parent-team"};class v{constructor(e){o(this,"teamNumber");o(this,"scores");o(this,"participants");o(this,"percents");o(this,"deposits");o(this,"refs");o(this,"score");o(this,"price");this.teamNumber=e,this.scores=[1,1,1],this.participants=["","",""],this.percents=[33.33,33.33,33.33],this.refs=[!1,!1,!1],this.deposits=[!1,!1,!1],this.score=null,this.price=null}init(){this.setupDepositEventListeners(),this.setupRefEventListeners(),this.setupCalculateBtnEvent()}fullReset(){this.scores=[1,1,1],this.participants=["","",""],this.percents=[33.33,33.33,33.33],this.refs=[!1,!1,!1],this.deposits=[!1,!1,!1],this.score=null,this.price=null}updateScore(){for(let e=0;e<3;e++)this.deposits[e]===!0?this.scores[e]=3:this.refs[e]===!0?this.scores[e]=2:this.scores[e]=1}setupCalculateBtnEvent(){const e=document.getElementById(l(h.CALCULATE_BTN,"-",this.teamNumber.toString())),t=document.getElementById(l(h.BONUS_INPUT,"-",this.teamNumber.toString())),n=document.getElementById(l(h.BET_INPUT,"-",this.teamNumber.toString())),s=document.getElementById(l(h.PERCENT_INPUT,"-",this.teamNumber.toString()));e==null||t==null||n==null||s==null||e.addEventListener("click",()=>{if(t.value==""||n.value==""||s.value=="")return;const r=parseFloat(t.value),i=parseFloat(n.value),m=parseFloat(s.value);if(isNaN(r)||isNaN(i)||isNaN(m))return;const f=Math.floor((r+i)/m),E=p.getTotalScore(this.teamNumber),C=document.getElementById(E);if(C==null)throw new Error("total score is not found");C.textContent=`X${f}`,this.score=f,this.price=r})}resetCalculateInputFields(){const e=document.getElementById(l(h.BONUS_INPUT,"-",this.teamNumber.toString())),t=document.getElementById(l(h.BET_INPUT,"-",this.teamNumber.toString())),n=document.getElementById(l(h.PERCENT_INPUT,"-",this.teamNumber.toString()));e==null||t==null||n==null||(e.value="",t.value="",n.value="")}showCalculateResult(){const e=document.getElementById(l(h.RESULT_TABLE,"-",this.teamNumber.toString())),t=document.getElementById(l(h.PARENT_TABLE,"-",this.teamNumber.toString()));e==null||t==null||(e.classList.remove("!hidden"),t.classList.add("!hidden"))}hideCalculateResult(){const e=document.getElementById(l(h.RESULT_TABLE,"-",this.teamNumber.toString())),t=document.getElementById(l(h.PARENT_TABLE,"-",this.teamNumber.toString()));e==null||t==null||(e.classList.add("!hidden"),t.classList.remove("!hidden"))}resetTotalScoreDisplay(){const e=p.getTotalScore(this.teamNumber),t=document.getElementById(e);if(t==null)throw new Error("total score is not found");t.textContent="Общий балл: 3"}updateDisplayScore(){const e=this.scores.reduce((r,i)=>r+i,0),t=Math.floor(100/e*100)/100,n=p.getTotalScore(this.teamNumber),s=document.getElementById(n);if(s==null)throw new Error("total score is not found");s.textContent=`Общий балл: ${e}`;for(let r=1;r<4;r++){const i=p.getScore(this.teamNumber,r),m=p.getPercent(this.teamNumber,r),f=document.getElementById(i),E=document.getElementById(m);if(f==null||E==null)throw new Error("score or percent are not found");f.textContent=`Балл: ${this.scores[r-1]}`;const C=Math.floor(this.scores[r-1]*t*100)/100;this.percents[r-1]=C,E.textContent=`${C}%`}}setupDepositEventListeners(){for(let e=1;e<4;e++){const t=p.getDeposit(this.teamNumber,e),n=document.getElementById(t);if(n==null)throw new Error("deposit is not found");n.addEventListener("change",()=>{this.updateDeposits(),this.updateScore(),this.updateDisplayScore()})}}setupRefEventListeners(){for(let e=1;e<4;e++){const t=p.getRef(this.teamNumber,e),n=document.getElementById(t);if(n==null)throw new Error("ref is not found");n.addEventListener("change",()=>{this.updateRefs(),this.updateScore(),this.updateDisplayScore()})}}updateRefs(){for(let e=1;e<4;e++){const t=p.getRef(this.teamNumber,e),n=document.getElementById(t);if(n==null)throw new Error("ref is not found");this.refs[e-1]=n.checked}}updateDeposits(){for(let e=1;e<4;e++){const t=p.getDeposit(this.teamNumber,e),n=document.getElementById(t);if(n==null)throw new Error("deposit is not found");this.deposits[e-1]=n.checked}}saveParticipantsNames(){for(let e=1;e<4;e++){const t=p.getParticipant(this.teamNumber,e),n=document.getElementById(t);if(n==null)throw new Error("element is not found");this.participants[e-1]=n.value}}}const g={BTN_LAUNCH_CAROUSEL:"rotate-btn",BTN_RESET:"reset-btn",BTN_RESULTS:"results-btn",RESULT_POPUP:"result-popup",RESULT_POPUP_CELL:"result-popup-cell"},L=new P,a=new v(1),c=new v(2),S=new b(1),N=new b(2);class A{constructor(){o(this,"memo");this.memo=new Map}init(){this.setupBtnEventListener(),L.populateTable(1),L.populateTable(2),a.init(),c.init(),S.init(),N.init()}showRestartBtn(){const e=document.getElementById(g.BTN_RESET),t=document.getElementById(g.BTN_LAUNCH_CAROUSEL);t==null||e==null||(e.classList.remove("!hidden"),t.classList.add("!hidden"))}showLaunchCarouselBtn(){const e=document.getElementById(g.BTN_RESET),t=document.getElementById(g.BTN_LAUNCH_CAROUSEL);t==null||e==null||(e.classList.add("!hidden"),t.classList.remove("!hidden"))}setupBtnEventListener(){const e=document.getElementById(g.BTN_LAUNCH_CAROUSEL),t=document.getElementById(g.BTN_RESET),n=document.getElementById("calculate-team-1"),s=document.getElementById("calculate-team-2"),r=document.getElementById(g.BTN_RESULTS);if(e==null||t==null||n==null||s==null||r==null)throw new Error("One of the buttons is undefined");e.addEventListener("click",()=>{e.disabled=!0,a.resetCalculateInputFields(),c.resetCalculateInputFields(),this.resetWinner(),this.launchCarousel(),a.showCalculateResult(),c.showCalculateResult(),a.saveParticipantsNames(),c.saveParticipantsNames(),setTimeout(()=>{this.showRestartBtn(),e.disabled=!1},1e4)}),t.addEventListener("click",()=>{this.cleanup(),a.fullReset(),c.fullReset()}),s.addEventListener("click",()=>{setTimeout(()=>this.assignWinner(),100)}),n.addEventListener("click",()=>{setTimeout(()=>this.assignWinner(),100)}),r.addEventListener("click",()=>this.showResultPopup());const i=document.getElementById(g.RESULT_POPUP);if(i==null)throw new Error("result popup is undefined");i.addEventListener("click",m=>{m.target===m.currentTarget&&(i.style.opacity="0%",setTimeout(()=>{i.classList.add("hidden"),i.style.opacity="100%"},500))})}showResultPopup(){const e=document.getElementById(g.RESULT_POPUP),t=document.getElementById(g.RESULT_POPUP_CELL);if(e==null||t==null)throw new Error("result popup is undefined");const n=e.querySelector("div");if(n==null)throw new Error("result popup child is undefined");n.innerHTML="",this.memo.forEach((s,r)=>{console.log(s,r);const i=t.content.cloneNode(!0),m=i.querySelector("div.text-center");if(m==null)return;m.textContent=r,n.appendChild(i);const f=t.content.cloneNode(!0),E=f.querySelector("div.text-center");E!=null&&(E.textContent=s,n.appendChild(f))}),e.style.opacity="0%",e.classList.remove("hidden"),e.style.opacity="100%"}cleanup(){L.populateTable(1),L.populateTable(2),S.resetDisplay(),N.resetDisplay(),a.hideCalculateResult(),c.hideCalculateResult(),a.init(),c.init(),a.resetTotalScoreDisplay(),c.resetTotalScoreDisplay(),a.resetCalculateInputFields(),c.resetCalculateInputFields(),this.showLaunchCarouselBtn(),this.resetWinner()}launchCarousel(){S.startInfiniteRotation(),N.startInfiniteRotation()}assignWinner(){if(a.score!=null&&c.score!=null){const e=document.getElementById("container-team-1"),t=document.getElementById("container-team-2");if(e==null||t==null)return;a.score>c.score?(e.classList.add("winner"),t.classList.add("loser"),this.saveWins(a.price,a.participants,a.percents)):a.score<c.score&&(e.classList.add("loser"),t.classList.add("winner"),this.saveWins(c.price,c.participants,c.percents))}}saveWins(e,t,n){if(e==null)throw new Error("the price is null");for(let s=0;s<3;s++){const r=t[s],i=n[s];console.log(r,e,i),this.memo.set(r,Math.floor(e/100*i).toString())}}resetWinner(){if(a.score!=null&&c.score!=null){const e=document.getElementById("container-team-1"),t=document.getElementById("container-team-2");if(e==null||t==null)return;e.classList.remove("winner"),t.classList.remove("loser"),e.classList.remove("loser"),t.classList.remove("winner")}}}const O=new A;O.init();
